/*!
 scrollsmartly.js v0.1.0
 Copyright (c) 2013 - 2014 Shinnosuke Watanabe | MIT License

 scrollsmoothly.js
 Copyright (c) 2008 KAZUMiX | MIT License
 http://d.hatena.ne.jp/KAZUMiX/20080418/scrollsmoothly
*/
!function(a,b,c,d,e){"use strict";function f(){if(v.length>0){console.log(v);var a=v.shift();a()}}function g(){x=!0}function h(a){if(s.hashScrollSynced){var b=a||event,c=b.target||b.srcElement;c.href!==e&&-1!==c.href.indexOf("#")&&k(!1)}}function i(){x===!0&&(m(),X!==e&&(x=!1)),l(),s.easing<1&&(s.easing=1);var b=(A-D)/s.easing,c=(B-E)/s.easing;if(s.velocity=[b,c],gb(b)<.05&&gb(c)<.05||F===D&&G===E||y){if(X!==e&&X.disconnect(),K(a,"scroll",U),y)return;return scrollTo(A,B),s.scrolledTo=z,y=!0,s.velocity=[0,0],void(w.length>0?s.scroll(w.shift()):(j(),s.scrollingTo=F=G=null,"function"==typeof r&&r(),f(),a.dispatchEvent(_)))}F=D,G=E,scrollTo(D+(b>=0?Math.ceil(b):Math.round(b)),E+(c>=0?Math.ceil(c):Math.floor(c))),db=M(i)}function j(){!s.scrollHashSynced||C===c.hash.substring(1)||v.length>0||(""!==C?(k(!1),d.pushState!==e?d.pushState("",b.title,c.pathname+"#"+C):n()||0!==s.marginLeft||0!==s.marginTop?(z.id="",c.hash="#"+C,z.id=C):c.hash="#"+C):""!==c.hash&&d.pushState!==e&&(k(!1),d.pushState("",b.title,c.pathname)))}function k(a){s.scrollHashSynced&&(a?clearTimeout(eb):(O=!1,eb=setTimeout(function(){O=!0},30)))}function l(){s.currentLeft=D=b.documentElement.scrollLeft||b.body.scrollLeft,s.currentTop=E=b.documentElement.scrollTop||b.body.scrollTop}function m(){for(var a=0,b=0,c=z;c;){if(c.offsetLeft!==e)a+=c.offsetLeft,b+=c.offsetTop;else{var d=c.getBoundingClientRect();a+=d.left,b+=d.top}c=c.offsetParent}var f=fb(),g=o();A=Math.min(a+g.x,f.x),0>A&&(A=0),B=Math.min(b+g.y,f.y),0>B&&(B=0)}function n(){return s.position&&"left top"!==s.position}function o(){var a=0,b=0;if(n()){var c=String(s.position).split(" ");1===c.length&&(c[1]=c[0]);var d,f;if(z.offsetWidth!==e)d=z.offsetWidth,f=z.offsetHeight;else{var g=z.getBoundingClientRect();d=g.width,f=g.height}var h;h=p(c[0]),a=parseInt((I-d)*h,10),h=p(c[1]),b=parseInt((J-f)*h,10)}return{x:-(a+s.marginLeft),y:-(b+s.marginTop)}}function p(a){return"left"===a||"top"===a?0:"center"===a?.5:"right"===a||"bottom"===a?1:"%"===a.charAt(a.length-1)?.01*parseFloat(a):0}function q(a,b){if(a){var c;c=a.length===e?[a]:a;for(var d=0;d<c.length;d++)b.call(s,c[d],d)}}var r,s={},t=c.href.split("#")[0],u=!0,v=[],w=[],x=null,y=!0;s.set=function(){switch(arguments.length){case 1:if("object"==typeof arguments[0])for(var a in arguments[0])s.hasOwnProperty(a)&&(s[a]=arguments[0][a]);break;case 2:s.hasOwnProperty(arguments[0])&&(s[arguments[0]]=arguments[1])}return f(),s},s.delay=function(){function a(a,e){return function(){var f=arguments,g=function(){setTimeout(function(){"function"==typeof b&&b.apply(this,d),a.apply(s,f)},e)};return null!==s.scrollingTo?v[v.length]=g:g(),-1!==c?s:s.delay(-1)}}var b,c=0,d=[];switch(arguments.length){case 0:break;case 1:"function"==typeof arguments[0]?b=arguments[0]:c=arguments[0];break;case 2:b=arguments[0],c=arguments[1];break;default:b=arguments[0],c=arguments[1];for(var e=2;e<arguments.length;e++)d[e-2]=arguments[e]}var f={};for(var g in s)f[g]="function"==typeof s[g]&&"delay"!==g?a(s[g],c):s[g];return f},s.easing=6,s.scrollingTo=null,s.scrolledTo=null,s.hashScrollSynced=!0,s.scrollHashSynced=!0,s.currentLeft=0,s.currentTop=0,s.position="left top",s.marginLeft=0,s.marginTop=0,s.velocity=[0,0];var z,A=0,B=0,C="",D=0,E=0,F=null,G=null,H=b.documentElement||b.body;s.homeElement=H;var I=0,J=0;""===c.hash&&-1!==c.href.indexOf("#")&&d.replaceState!==e&&d.replaceState("",b.title,c.pathname);var K,L;a.addEventListener!==e?(K=function(a,b,c){a.addEventListener(b,c,!1)},L=function(a,b,c){a.removeEventListener(b,c,!1)}):(K=function(a,b,c){a.attachEvent("on"+b,c)},L=function(a,b,c){a.detachEvent("on"+b,c)});for(var M,N,O=!0,P=function(){O&&s.hashScrollSynced&&(scrollTo(D,E),s.scroll(c.hash.substring(1)))},Q=null,R=0,S=["ms","moz","webkit","o"],T=0;T<S.length&&!a.requestAnimationFrame;++T)M=a[S[T]+"RequestAnimationFrame"],N=a[S[T]+"CancelAnimationFrame"]||a[S[T]+"CancelRequestAnimationFrame"];S=null,M&&N||(M=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-R)),d=setTimeout(function(){a(b+c)},c);return R=b+c,d},N=function(a){clearTimeout(a)});var U=function(){l()},V=null,W=function(){null!==V&&clearTimeout(Q),V=setTimeout(function(){g()},50)};MutationObserver=a.MutationObserver||a.WebKitMutationObserver||a.MozMutationObserver||!1;var X;MutationObserver?X=new MutationObserver(function(){g()}):x=!0;var Y,Z,$,_,ab=function(c){c?(Y=function(a){a.preventDefault(),a.stopPropagation(),s.scroll(this.scrollSmartlyTarget!==e?this.scrollSmartlyTarget:this.hash.substring(1))},Z=function(c){var d=b.createEvent("HTMLEvents");return d.initEvent(c,!1,!1),a["on"+c]=null,K(a,c,function(a){var b=this["on"+c];"function"==typeof b&&b(a)}),d}):(Y=function(){var a=event.srcElement||event.target;event.returnValue=!1,event.cancelBubble=!0,s.scroll(a.hash.substring(1))},Z=function(c){var d=b.createEvent("HTMLEvents");return d.initEvent(c,!1,!1),a["on"+c]=null,K(a,c,function(){var a=event,b=this["on"+c];"function"==typeof b&&b(a)}),d}),$=Z("smartlystart"),_=Z("smartlyend"),K(a,"hashchange",P),K(a,"scroll",U),K(a,"resize",W),ab=function(){}};K(b,"DOMContentLoaded",function(a){ab(a)}),K(a,"load",function(d){ab(d),l(),ib(),!s.hashScrollSynced||""===c.hash&&s.homeElement===H||(a.attachEvent!==e&&a.opera===e?setTimeout(function(){scrollTo(0,0),s.scroll(c.hash.substring(1)||s.homeElement)},30):(scrollTo(0,0),s.scroll(c.hash.substring(1)||s.homeElement))),K(b.body,"click",h),u=!1});var bb;if(Array.isArray!==e)bb=Array.isArray;else{var cb=Object.prototype.toString.call;bb=function(a){return"[object Array]"===cb(a)}}s.scroll=function(){var c=[""],d=null;switch(arguments.length){case 0:break;case 1:"object"==typeof arguments[0]?(1===arguments[0].nodeType?c[0]=arguments[0]:arguments[0].via!==e?(c=bb(arguments[0].via)?arguments[0].via:[arguments[0].via],arguments[0].to!==e&&c.push(arguments[0].to)):c[0]=arguments[0].to,arguments[0].callback!==e&&(d=arguments[0].callback)):"function"!=typeof arguments[0]?c[0]=arguments[0]:d=arguments[0];break;case 2:"function"==typeof arguments[1]?(c[0]=arguments[0],d=arguments[1]):(c[0]=arguments[0],c[1]=arguments[1]);break;default:for(var f=arguments.length-1,g=0;f>g;g++)c[g]=arguments[g];"function"==typeof arguments[f]?d=arguments[f]:c[f]=arguments[f]}var h=c.shift();return 1===h.nodeType?(z=h,C=h.id):"string"==typeof h&&(z=""!==h?b.getElementById(h):s.homeElement?s.homeElement:H,C=h),null===z?s:(c.length>0&&(w=c),m(),X!==e&&X.observe(b.body,{attributes:!0,subtree:!0,characterData:!1}),null!==s.scrollingTo&&y?s.scrollingTo=z:(s.scrollingTo=z,d=d||null,N(db),a.dispatchEvent($)),L(a,"scroll",U),k(!0),y=!1,i(),s)};var db,eb,fb,gb=(Math.round,Math.abs);if(a.scrollMaxX!==e)fb=function(){return{x:a.scrollMaxX,y:a.scrollMaxY}};else{fb=function(){var a=hb();return ib(),{x:a.width-I,y:a.height-J}};var hb=function(){return{width:Math.max(b.body.scrollWidth,b.documentElement.scrollWidth),height:Math.max(b.body.scrollHeight,b.documentElement.scrollHeight)}}}var ib;if(H.clientWidth!==e)ib=function(){I=H.clientWidth,J=H.clientHeight};else if(a.innerWidth){var jb=b.createElement("div"),kb=jb.style;kb.position="absolute",kb.left=kb.top="0",kb.width=kb.height="100%",kb.margin=kb.padding="0",kb.border="none",kb.visibility="hidden",ib=function(){b.body.appendChild(jb),I=jb.offsetWidth,J=jb.offsetHeight,b.body.removeChild(jb)}}s.stop=function(){return y=!0,w=[],s.scrollingTo=null,f(),s},s.finish=function(){return v=[],s.stop(),s},s.on=function(a,b){return q(a,function(a){a.scrollSmartlyTarget=b!==e?b:"",K(a,"click",Y),a.style.cursor="pointer"}),f(),s},s.off=function(a){return q(a,function(a){delete a.scrollSmartlyTarget,L(a,"click",Y),a.style.cursor=""}),f(),s},s.replaceAnchor=function(a,b){var c=a.href+"",d=c.lastIndexOf("#");return c.substring(0,d)===t&&(a.hash!==e&&(a.hash=c.substring(d+1)),delete a.scrollSmartlyTarget,K(a,"click",Y)),b!==!0?(f(),s):void 0},s.all=function(){if(u)return K(a,"load",function(){u=!1,s.all()}),f(),s;for(var c=b.links,d=0;d<c.length;d++)s.replaceAnchor(c[d],!0);return f(),s},a.smartly=s,"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("scrollsmartly",[],function(){return s}):"undefined"!=typeof module&&module.exports&&((module.exports=s).smartly=s)}(window,document,location,history);